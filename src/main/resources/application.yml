# ========================================
# 應用程式設定
# ========================================

spring:
  application:
    name: booking-platform

  # ========================================
  # 資料庫設定
  # ========================================
  datasource:
    url: jdbc:postgresql://127.0.0.1:5433/booking_platform
    username: postgres
    password: postgres
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      idle-timeout: 300000
      connection-timeout: 20000
      max-lifetime: 1200000

  # ========================================
  # JPA 設定
  # ========================================
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect
        jdbc:
          time_zone: Asia/Taipei
    open-in-view: false

  # ========================================
  # Redis 設定
  # ========================================
  data:
    redis:
      host: localhost
      port: 6379
      database: 0
      connect-timeout: 5000ms
      timeout: 5000ms

  # ========================================
  # 郵件設定（Gmail SMTP）
  # ========================================
  mail:
    host: smtp.gmail.com
    port: 587
    username: ${MAIL_USERNAME:your-email@gmail.com}
    password: ${MAIL_PASSWORD:your-app-password}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
          connectiontimeout: 5000
          timeout: 5000
          writetimeout: 5000
    default-encoding: UTF-8

  # ========================================
  # Jackson 設定
  # ========================================
  jackson:
    time-zone: Asia/Taipei
    date-format: yyyy-MM-dd HH:mm:ss
    serialization:
      write-dates-as-timestamps: false
    deserialization:
      fail-on-unknown-properties: false

# ========================================
# 伺服器設定
# ========================================
server:
  port: 8080
  servlet:
    context-path: /
  # Gzip 壓縮（SEO 優化 - 提升載入速度）
  compression:
    enabled: true
    min-response-size: 1024
    mime-types:
      - application/json
      - application/xml
      - text/html
      - text/plain
      - text/css
      - application/javascript
      - text/javascript
      - image/svg+xml

# ========================================
# 靜態資源快取（SEO 優化）
# ========================================
spring.web.resources:
  cache:
    cachecontrol:
      max-age: 31536000
      public: true
  chain:
    strategy:
      content:
        enabled: true
        paths: /js/**,/css/**,/images/**

# ========================================
# Logging 設定
# ========================================
logging:
  level:
    root: INFO
    com.booking.platform: DEBUG
    org.springframework.security: INFO
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE

# ========================================
# JWT 設定
# ========================================
jwt:
  secret: booking-platform-jwt-secret-key-must-be-at-least-256-bits-long-for-hs256
  expiration: 86400000  # 24 小時（毫秒）
  refresh-expiration: 604800000  # 7 天（毫秒）

# ========================================
# LINE Bot 設定
# ========================================
line:
  bot:
    channel-token: ${LINE_CHANNEL_TOKEN:your-channel-token}
    channel-secret: ${LINE_CHANNEL_SECRET:your-channel-secret}
    # API 端點
    api-endpoint: https://api.line.me
    # Webhook 驗證
    webhook-verify-enabled: true
  # 對話設定
  conversation:
    # 對話狀態 TTL（秒）
    ttl: 1800
    # Redis Key 前綴
    key-prefix: "line:conversation:"

# ========================================
# 加密設定
# ========================================
encryption:
  # AES-256-GCM 加密金鑰（32 bytes = 256 bits，Base64 編碼）
  # 正式環境請使用環境變數
  secret-key: ${ENCRYPTION_SECRET_KEY:YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY=}

# ========================================
# 應用程式自訂設定
# ========================================
app:
  # 基礎 URL（用於郵件中的連結）
  base-url: ${APP_BASE_URL:http://localhost:8080}

  # 郵件設定
  email:
    from: ${MAIL_USERNAME:your-email@gmail.com}
    from-name: 預約平台

  # 分頁設定
  pagination:
    default-size: 20
    max-size: 100

  # 快取設定
  cache:
    default-ttl: 1800  # 30 分鐘（秒）

  # 上傳設定
  upload:
    max-file-size: 10485760  # 10MB
    allowed-types: image/jpeg,image/png,image/gif

# ========================================
# Actuator 設定
# ========================================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when-authorized
  health:
    redis:
      enabled: false

# ========================================
# 排程設定
# ========================================
scheduler:
  # 預約提醒
  booking-reminder:
    enabled: true
    cron: "0 0 * * * *"  # 每小時整點執行

  # 額度重置（每月1日凌晨）
  quota-reset:
    enabled: true
    cron: "0 5 0 1 * *"

  # 行銷推播（每分鐘檢查）
  marketing-push:
    enabled: true
    cron: "0 * * * * *"

  # 生日祝福（每日早上 9:00）
  birthday-greeting:
    enabled: true
    cron: "0 0 9 * * *"

  # 顧客喚回（每日下午 2:00）
  customer-recall:
    enabled: true
    cron: "0 0 14 * * *"
    max-per-tenant: 50

# ========================================
# SMS 設定
# ========================================
sms:
  enabled: ${SMS_ENABLED:false}
  provider: ${SMS_PROVIDER:mitake}
  mitake:
    username: ${SMS_USERNAME:}
    password: ${SMS_PASSWORD:}
    api-url: https://smsapi.mitake.com.tw/api/mtk/SmSend
  twsms:
    username: ${TWSMS_USERNAME:}
    password: ${TWSMS_PASSWORD:}
    api-url: https://api.twsms.com/json/sms_send.php
  every8d:
    user-id: ${EVERY8D_USER_ID:}
    password: ${EVERY8D_PASSWORD:}
    api-url: https://oms.every8d.com/API21/HTTP/sendSMS.ashx

# ========================================
# ECPay 設定
# ========================================
ecpay:
  merchant-id: ${ECPAY_MERCHANT_ID:}
  hash-key: ${ECPAY_HASH_KEY:}
  hash-iv: ${ECPAY_HASH_IV:}
  api-url: https://payment.ecpay.com.tw/Cashier/AioCheckOut/V5

# ========================================
# Groq AI 設定
# ========================================
groq:
  enabled: ${GROQ_ENABLED:false}
  api-key: ${GROQ_API_KEY:}
  model: ${GROQ_MODEL:llama-3.3-70b-versatile}
  api-url: https://api.groq.com/openai/v1
  max-tokens: 300
  temperature: 0.5
